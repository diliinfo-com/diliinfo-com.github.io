/* Safari 兼容性样式修复 */

/* 1. Flexbox 兼容性修复 */
.flex-container {
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
}

.flex-item {
  -webkit-box-flex: 1;
  -webkit-flex: 1 1 0%;
  -ms-flex: 1 1 0%;
  flex: 1 1 0%; /* 显式声明 flex-basis 修复 Safari bug */
}

.flex-center {
  -webkit-box-pack: center;
  -webkit-justify-content: center;
  -ms-flex-pack: center;
  justify-content: center;
  -webkit-box-align: center;
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
}

/* Safari 特定的 flex 修复 */
@supports (-webkit-overflow-scrolling: touch) {
  .flex-container {
    -webkit-flex-basis: auto;
    flex-basis: auto;
  }
}

/* 2. Grid 布局兼容性修复 */
.grid-container {
  display: -ms-grid;
  display: grid;
}

/* 使用 grid-gap 替代 gap 以兼容旧版 Safari */
.grid-gap {
  -webkit-grid-gap: 1rem;
  grid-gap: 1rem;
  gap: 1rem;
}

/* 3. CSS 变量兼容性处理 */
.no-css-variables {
  /* 为不支持 CSS 变量的浏览器提供回退值 */
}

.no-css-variables .primary-color {
  color: #007bff; /* 回退到固定颜色 */
}

.no-css-variables .secondary-color {
  color: #6c757d;
}

/* 4. 伪元素兼容性修复 */
input::-webkit-input-placeholder {
  color: #999;
  opacity: 1;
}

input::-moz-placeholder {
  color: #999;
  opacity: 1;
}

input:-ms-input-placeholder {
  color: #999;
  opacity: 1;
}

input::placeholder {
  color: #999;
  opacity: 1;
}

/* 5. 滚动条样式兼容 */
.custom-scrollbar {
  -webkit-overflow-scrolling: touch;
}

.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background: #c1c1c1;
  border-radius: 4px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background: #a8a8a8;
}

/* 6. 动画性能优化 */
.hardware-accelerated {
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-perspective: 1000px;
  perspective: 1000px;
}

/* 7. 触摸优化 */
.touch-optimized {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

/* 8. iOS Safari 特定修复 */
.ios input[type="text"],
.ios input[type="email"],
.ios input[type="password"],
.ios textarea {
  -webkit-appearance: none;
  border-radius: 0;
}

.ios .prevent-zoom {
  font-size: 16px; /* 防止 iOS Safari 缩放 */
}

/* 9. 微信浏览器特定修复 */
.wechat body {
  -webkit-overflow-scrolling: touch;
}

.wechat .fixed-element {
  /* 微信浏览器中的固定定位修复 */
  position: absolute;
}

/* 10. 表单元素兼容性 */
.form-control {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  border-radius: 4px;
  border: 1px solid #ddd;
  padding: 8px 12px;
  font-size: 16px; /* 防止 iOS 缩放 */
}

.form-control:focus {
  outline: none;
  border-color: #007bff;
  -webkit-box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
  box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
}

/* 11. 按钮样式兼容 */
.btn {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  border: none;
  border-radius: 4px;
  padding: 8px 16px;
  font-size: 16px;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

.btn:active {
  -webkit-transform: translateY(1px);
  transform: translateY(1px);
}

/* 12. 媒体查询兼容性 */
@media screen and (-webkit-min-device-pixel-ratio: 2) {
  .retina-image {
    /* 高分辨率屏幕优化 */
  }
}

/* 13. 安全区域适配（iPhone X 等） */
@supports (padding: max(0px)) {
  .safe-area-inset {
    padding-left: max(16px, env(safe-area-inset-left));
    padding-right: max(16px, env(safe-area-inset-right));
    padding-top: max(16px, env(safe-area-inset-top));
    padding-bottom: max(16px, env(safe-area-inset-bottom));
  }
}

/* 14. 无 flex gap 支持的回退 */
.no-flex-gap .flex-gap > * + * {
  margin-left: 1rem;
}

.no-flex-gap .flex-gap-vertical > * + * {
  margin-top: 1rem;
}

/* 15. 无 grid gap 支持的回退 */
.no-grid-gap .grid-gap .grid-item {
  margin: 0.5rem;
}

/* 16. 打印样式兼容 */
@media print {
  .no-print {
    display: none !important;
  }
  
  .print-break-before {
    page-break-before: always;
  }
  
  .print-break-after {
    page-break-after: always;
  }
}

/* 17. 深色模式兼容 */
@media (prefers-color-scheme: dark) {
  .auto-dark {
    background-color: #1a1a1a;
    color: #ffffff;
  }
}

/* 18. 减少动画偏好 */
@media (prefers-reduced-motion: reduce) {
  .respect-motion-preference {
    animation: none !important;
    transition: none !important;
  }
}