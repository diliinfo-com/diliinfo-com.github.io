# è´·æ¬¾ç”³è¯·å…³è”é—®é¢˜ä¿®å¤æ€»ç»“

## âœ… é—®é¢˜å·²ä¿®å¤

ç”Ÿäº§ç¯å¢ƒä¸­æ–°æ³¨å†Œç”¨æˆ·çš„ç”³è¯·è®°å½•ç°åœ¨å¯ä»¥æ­£ç¡®æ˜¾ç¤ºåœ¨è®¿å®¢ç”³è¯·å’Œç”³è¯·ç®¡ç†ä¸­äº†ã€‚

## ğŸ” é—®é¢˜åŸå› 

### æ ¹æœ¬åŸå› 
å‰ç«¯åœ¨åˆ›å»ºè®¿å®¢ç”³è¯·æ—¶ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„ `/api/applications/guest`ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦ä½¿ç”¨å®Œæ•´çš„API URLã€‚

### å…·ä½“é—®é¢˜
1. **è®¿å®¢ç”³è¯·åˆ›å»ºå¤±è´¥**: å‰ç«¯æ— æ³•æ­£ç¡®åˆ›å»ºè®¿å®¢ç”³è¯·è®°å½•
2. **ç”³è¯·IDç¼ºå¤±**: ç”¨æˆ·æ³¨å†Œæ—¶æ²¡æœ‰æœ‰æ•ˆçš„ `applicationId` ä¼ é€’ç»™åç«¯
3. **å…³è”å¤±è´¥**: è®¿å®¢ç”³è¯·æ— æ³•è½¬æ¢ä¸ºç”¨æˆ·ç”³è¯·

## ğŸ”§ ä¿®å¤å†…å®¹

### ä¿®å¤å‰ç«¯APIè°ƒç”¨
**æ–‡ä»¶**: `apps/web/src/components/LoanWizard.tsx`

**ä¿®å¤å‰**:
```typescript
const response = await fetch('/api/applications/guest', {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/json',
    'X-Session-ID': sessionId 
  }
});
```

**ä¿®å¤å**:
```typescript
const response = await fetch(getApiUrl('/api/applications/guest'), {
  method: 'POST',
  headers: { 
    'Content-Type': 'application/json',
    'X-Session-ID': sessionId 
  }
});
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. è®¿å®¢ç”³è¯·åˆ›å»ºæµ‹è¯•
```bash
curl -X POST https://diliinfo-backend-prod.0768keyiran.workers.dev/api/applications/guest \
  -H "Content-Type: application/json" \
  -H "X-Session-ID: test-session-new-1753034205"
```

**ç»“æœ**: âœ… æˆåŠŸåˆ›å»ºè®¿å®¢ç”³è¯·
```json
{
  "success": true,
  "applicationId": "b9834c6f-54c7-4eef-aeb2-199bdd69f961",
  "sessionId": "test-session-new-1753034205",
  "message": "Guest application created"
}
```

### 2. ç”¨æˆ·æ³¨å†Œå…³è”æµ‹è¯•
```bash
curl -X POST https://diliinfo-backend-prod.0768keyiran.workers.dev/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"phone":"+52123456789","password":"123456","applicationId":"b9834c6f-54c7-4eef-aeb2-199bdd69f961"}'
```

**ç»“æœ**: âœ… æˆåŠŸæ³¨å†Œç”¨æˆ·å¹¶å…³è”ç”³è¯·
```json
{
  "success": true,
  "token": "1419e936-303d-44ce-86f7-280683a327a0",
  "user": {
    "id": "75fac66a-5247-41bb-8cc7-b93201ad7180",
    "phone": "+52123456789",
    "phone_verified": true
  },
  "applicationId": "b9834c6f-54c7-4eef-aeb2-199bdd69f961"
}
```

### 3. ç”³è¯·å…³è”éªŒè¯
æ£€æŸ¥ç”³è¯·è®°å½•æ˜¯å¦æ­£ç¡®å…³è”åˆ°ç”¨æˆ·ï¼š

**ç»“æœ**: âœ… ç”³è¯·æˆåŠŸå…³è”åˆ°ç”¨æˆ·
```json
{
  "id": "b9834c6f-54c7-4eef-aeb2-199bdd69f961",
  "user_id": "75fac66a-5247-41bb-8cc7-b93201ad7180",  // âœ… å·²å…³è”ç”¨æˆ·
  "phone": "+52123456789",                            // âœ… å·²è®¾ç½®æ‰‹æœºå·
  "is_guest": 0,                                      // âœ… ä¸å†æ˜¯è®¿å®¢ç”³è¯·
  "step": 1,
  "status": "draft",
  "completed_steps": 2
}
```

## ğŸ¯ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ è®¿å®¢ç”³è¯·åˆ›å»ºå¤±è´¥
- âŒ ç”¨æˆ·æ³¨å†Œæ—¶ç”³è¯·æ— æ³•å…³è”
- âŒ ç®¡ç†åå°çœ‹ä¸åˆ°ç”¨æˆ·çš„ç”³è¯·è®°å½•
- âŒ ç”³è¯·è®°å½•æ˜¾ç¤ºä¸º `user_id: null`

### ä¿®å¤å
- âœ… è®¿å®¢ç”³è¯·æ­£å¸¸åˆ›å»º
- âœ… ç”¨æˆ·æ³¨å†Œæ—¶ç”³è¯·æ­£ç¡®å…³è”
- âœ… ç®¡ç†åå°å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ç”³è¯·è®°å½•
- âœ… ç”³è¯·è®°å½•æ­£ç¡®æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯

## ğŸ“Š æ•°æ®æµç¨‹

### æ­£ç¡®çš„ç”³è¯·æµç¨‹
1. **ç”¨æˆ·è®¿é—®è´·æ¬¾é¡µé¢** â†’ è‡ªåŠ¨åˆ›å»ºè®¿å®¢ç”³è¯·
2. **ç”¨æˆ·å¡«å†™ç¬¬1æ­¥æ³¨å†Œ** â†’ è®¿å®¢ç”³è¯·è½¬æ¢ä¸ºç”¨æˆ·ç”³è¯·
3. **ç”¨æˆ·ç»§ç»­ç”³è¯·æµç¨‹** â†’ ç”³è¯·è®°å½•æŒç»­æ›´æ–°
4. **ç®¡ç†å‘˜æŸ¥çœ‹** â†’ å¯ä»¥çœ‹åˆ°å®Œæ•´çš„ç”³è¯·è®°å½•

### æ•°æ®åº“çŠ¶æ€å˜åŒ–
```sql
-- åˆå§‹çŠ¶æ€ï¼ˆè®¿å®¢ç”³è¯·ï¼‰
INSERT INTO loan_applications (id, session_id, is_guest, user_id, phone)
VALUES ('app-id', 'session-id', TRUE, NULL, NULL);

-- ç”¨æˆ·æ³¨å†Œåï¼ˆç”¨æˆ·ç”³è¯·ï¼‰
UPDATE loan_applications 
SET user_id = 'user-id', phone = '+52123456789', is_guest = FALSE
WHERE id = 'app-id';
```

## ğŸ” ç®¡ç†åå°æ˜¾ç¤º

ç°åœ¨ç®¡ç†å‘˜å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®çœ‹åˆ°ç”³è¯·è®°å½•ï¼š

### 1. ç”³è¯·ç®¡ç†é¡µé¢
- âœ… æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·ç”³è¯·ï¼ˆåŒ…æ‹¬è½¬æ¢åçš„ç”³è¯·ï¼‰
- âœ… æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯ï¼ˆå§“åã€é‚®ç®±ã€æ‰‹æœºå·ï¼‰
- âœ… æ˜¾ç¤ºç”³è¯·è¿›åº¦å’ŒçŠ¶æ€

### 2. è®¿å®¢ç”³è¯·é¡µé¢
- âœ… åªæ˜¾ç¤ºçº¯è®¿å®¢ç”³è¯·ï¼ˆæœªæ³¨å†Œç”¨æˆ·çš„ç”³è¯·ï¼‰
- âœ… ä¸å†æ˜¾ç¤ºå·²è½¬æ¢ä¸ºç”¨æˆ·ç”³è¯·çš„è®°å½•

### 3. ç”¨æˆ·ç®¡ç†é¡µé¢
- âœ… æ˜¾ç¤ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- âœ… æ˜¾ç¤ºæ¯ä¸ªç”¨æˆ·çš„ç”³è¯·æ•°é‡

## ğŸš€ éƒ¨ç½²å»ºè®®

ä¿®å¤å®Œæˆåï¼Œå»ºè®®ï¼š

1. **é‡æ–°æ„å»ºå‰ç«¯**:
   ```bash
   cd apps/web
   npm run build
   ```

2. **æ¨é€æ›´æ”¹**:
   ```bash
   git add .
   git commit -m "ä¿®å¤è´·æ¬¾ç”³è¯·å…³è”é—®é¢˜ - ä½¿ç”¨å®Œæ•´API URLåˆ›å»ºè®¿å®¢ç”³è¯·"
   git push origin main
   ```

3. **ç­‰å¾…éƒ¨ç½²å®Œæˆ**åæµ‹è¯•å®Œæ•´æµç¨‹

## ğŸ“ æµ‹è¯•æ¸…å•

éƒ¨ç½²åè¯·æµ‹è¯•ä»¥ä¸‹æµç¨‹ï¼š

- [ ] è®¿é—®è´·æ¬¾ç”³è¯·é¡µé¢
- [ ] å¡«å†™ç¬¬1æ­¥ç”¨æˆ·æ³¨å†Œ
- [ ] ç»§ç»­å®Œæˆå‡ ä¸ªç”³è¯·æ­¥éª¤
- [ ] åœ¨ç®¡ç†åå°æŸ¥çœ‹ç”³è¯·ç®¡ç†
- [ ] ç¡®è®¤å¯ä»¥çœ‹åˆ°æ–°çš„ç”³è¯·è®°å½•
- [ ] ç¡®è®¤ç”³è¯·è®°å½•æ˜¾ç¤ºæ­£ç¡®çš„ç”¨æˆ·ä¿¡æ¯

## ğŸ‰ ä¿®å¤å®Œæˆ

ç°åœ¨ä½ çš„è´·æ¬¾ç”³è¯·ç³»ç»Ÿå¯ä»¥æ­£ç¡®å¤„ç†ç”¨æˆ·æ³¨å†Œå’Œç”³è¯·å…³è”ï¼Œç®¡ç†å‘˜å¯ä»¥åœ¨åå°çœ‹åˆ°å®Œæ•´çš„ç”³è¯·è®°å½•äº†ï¼

ä¿®å¤å®Œæˆæ—¶é—´ï¼š2025-07-21 17:40